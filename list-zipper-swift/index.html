<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <meta name="description" content="Jeremy Cochoy's personal website.">
  <meta name="author" content="Jeremy Cochoy">

  <title>
    
      List Zipper applied to iOS swift &middot; Jeremy Cochoy
    
  </title>

  <!-- CSS -->
  <link href="/public/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Custom styles for this template -->
  <link href="/public/style.css" rel="stylesheet">

  <!-- Maths equations -->
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
  });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>


  <body>

    <!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
 <div class="container">
   <div class="navbar-header">
     <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
 <span class="sr-only">Toggle navigation</span>
 <span class="icon-bar"></span>
 <span class="icon-bar"></span>
 <span class="icon-bar"></span>
     </button>
     <a class="navbar-brand" href="/">Jeremy Cochoy</a>
   </div>
   <div id="navbar" class="collapse navbar-collapse">
     <ul class="nav navbar-nav">
     <li><a href="/resume/">Resume</a></li>
 <li><a href="/blog/">Blog</a></li>
 <li role="separator" class="divider"></li>
 <li><a href="/talks/">Talks</a></li>
 <li><a href="/research/">Research</a></li>
 <li><a href="/teaching/">Teaching</a></li>
 <li><a href="/music/">Music</a></li>
 <li class="dropdown">
   <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">More <span class="caret"></span></a>
   <ul class="dropdown-menu">
     <li><a href="/hyper-flop/">Hyper-Flop</a></li>
     <li role="separator" class="divider"></li>
     <li><a href="/pdfs/">PDFs & Talks</a></li>
     <li><a href="/agreg-dev/">Agregation de math√©matique</a></li>
     <li role="separator" class="divider"></li>
     <li><a href="https://github.com/jeremycochoy/sednl" alt="SEDNL Github">SEDNL (Github)</a></li>
     <li><a href="http://sednl.zenol.fr" alt="Simple Event Driven Network Library">SEDNL</a></li>
           <li role="separator" class="divider"></li>
           <li><a href="/gb-doc">GameBoy Emulator Documentation</a></li>
   </ul>
 </li>
     </ul>
   </div><!--/.nav-collapse -->
 </div>
</nav>


    <div class="container">
      <div class="post">
  <h1 class="post-title">List Zipper applied to iOS swift</h1>
  <span class="post-date">24 May 2019</span>
  <p>Recently, I was implementing a model for a music application where the user
edit a collection of tracks, while editing only one track at a time.
After a little thought, the best representation of this ‚Äúfocus‚Äù in the data
model was obviously a zipper.
Since this is not a common pattern, I thought it would be a wonderful example
of how such a simple pattern can encode the intention into the data structure.</p>

<h2 id="abstract-idea">Abstract idea</h2>
<p>The Zipper is a well known pattern in Haskell,
and although this language is rarely used in production,
some of its usage translate very well to other languages.
The List Zipper is basically a list where the element we are focusing at
was taken out.
It allow shifting the attention to the previous or next element,
and obviously to retrieve the whole list if required.</p>

<h2 id="usage">Usage</h2>
<p>Using a zipper is pretty simple.
You build it from a list, move inside it, and insert/remove elements.
Here is a short usage:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">zippy</span> <span class="o">=</span> <span class="kt">ListZipper</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="p">[</span><span class="s">"I"</span><span class="p">,</span> <span class="s">"love"</span><span class="p">,</span> <span class="s">"pancakes"</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="n">zippy</span><span class="o">.</span><span class="n">cursor</span><span class="o">!</span><span class="p">)</span> <span class="c1">// I</span>
<span class="n">zippy</span><span class="o">.</span><span class="nf">right</span><span class="p">()</span> <span class="c1">// move to the right</span>
<span class="nf">print</span><span class="p">(</span><span class="n">zippy</span><span class="o">.</span><span class="n">cursor</span><span class="o">!</span><span class="p">)</span> <span class="c1">// love</span>
<span class="n">zippy</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="s">"hate"</span>
<span class="nf">print</span><span class="p">(</span><span class="n">zippy</span><span class="o">.</span><span class="nf">toList</span><span class="p">()</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">" "</span><span class="p">))</span> <span class="c1">// I hate pancakes</span>
<span class="n">zippy</span><span class="o">.</span><span class="nf">remove</span><span class="p">()</span>
<span class="n">zippy</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="s">"Eat"</span>
<span class="nf">print</span><span class="p">(</span><span class="n">zippy</span><span class="o">.</span><span class="nf">toList</span><span class="p">()</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">" "</span><span class="p">))</span> <span class="c1">// Eat pancakes</span>
</code></pre></div></div>

<h2 id="implementation">Implementation</h2>
<p>Let‚Äôs start by the data itself.
We need to store the element of the list we are looking at (the cursor).
Since we are focusing on an element of the list,
we also need to remember what was before this element, and what comes next.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ListZipper</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="k">var</span> <span class="nv">leftList</span><span class="p">:</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="kd">private</span> <span class="k">var</span> <span class="nv">rightList</span><span class="p">:</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="c1">/// Cursor to the selected Track</span>
  <span class="k">var</span> <span class="nv">cursor</span><span class="p">:</span> <span class="kt">T</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Now that we have the informations,
we need a way to convert from a list to a ListZipper,
and from a ListZipper to a list.
We add an initializer with as a default an empty list,
and a function that glue together the beginning of the list, the cursor,
and the remaining part of the list.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">list</span><span class="p">:</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="n">first</span>
    <span class="n">rightList</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="nf">reversed</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="c1">/// Convert to a swift array</span>
  <span class="kd">func</span> <span class="nf">toList</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">c</span> <span class="o">=</span> <span class="n">cursor</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">leftList</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="n">rightList</span><span class="o">.</span><span class="nf">reversed</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">leftList</span> <span class="o">+</span> <span class="n">rightList</span><span class="o">.</span><span class="nf">reversed</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Notice how we handle the case where the curser is pointing to nothing.
(A case which could occurs from an empty list / empty zipper.)</p>

<p>Our zipper can store the information,
but is always pointing to the first element of the list.
This is pretty boring and not really useful.
We introduce two functions that allow to move on the right or the left of
our band.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Select the left element if available</span>
<span class="k">mutating</span> <span class="kd">func</span> <span class="nf">left</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">guard</span> <span class="n">leftList</span><span class="o">.</span><span class="n">isNotEmpty</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>

  <span class="k">if</span> <span class="k">let</span> <span class="nv">c</span> <span class="o">=</span> <span class="n">cursor</span> <span class="p">{</span><span class="n">rightList</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">c</span><span class="p">)}</span>
  <span class="n">cursor</span> <span class="o">=</span> <span class="n">leftList</span><span class="o">.</span><span class="nf">popLast</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">/// Select the right element if available</span>
<span class="k">mutating</span> <span class="kd">func</span> <span class="nf">right</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">guard</span> <span class="n">rightList</span><span class="o">.</span><span class="n">isNotEmpty</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>

  <span class="k">if</span> <span class="k">let</span> <span class="nv">c</span> <span class="o">=</span> <span class="n">cursor</span> <span class="p">{</span><span class="n">leftList</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">c</span><span class="p">)}</span>
  <span class="n">cursor</span> <span class="o">=</span> <span class="n">rightList</span><span class="o">.</span><span class="nf">popLast</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I personally choose to add guards for my particular usage,
because I always want to be pointing to a music track if my song is not empty.
But you could safely remove them.
In this setting you‚Äôd know you are on the bounds simply by checking if the
cursor is pointing to nothing.</p>

<p>One crucial step remaining to make this Zipper fully usable is a way to insert
and remove elements at the current location.
I choose to always insert on the right of the element pointed.
Symmetrically, when I remove the pointed element,
I automatically look to the left.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Insert a new track</span>
<span class="k">mutating</span> <span class="kd">func</span> <span class="nf">insert</span><span class="p">(</span><span class="nv">element</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">c</span> <span class="o">=</span> <span class="n">cursor</span> <span class="p">{</span><span class="n">leftList</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">c</span><span class="p">)}</span>

  <span class="n">cursor</span> <span class="o">=</span> <span class="n">element</span>
<span class="p">}</span>

<span class="c1">/// Remove the current pointed track</span>
<span class="k">mutating</span> <span class="kd">func</span> <span class="nf">remove</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">guard</span> <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">cursor</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>

  <span class="k">if</span> <span class="n">leftList</span><span class="o">.</span><span class="n">isNotEmpty</span> <span class="p">{</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">leftList</span><span class="o">.</span><span class="nf">popLast</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">rightList</span><span class="o">.</span><span class="nf">popLast</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice that in the case you removed the guard in the left/right functions,
you can also simplify remove by only poping the value from <code class="highlighter-rouge">leftList</code>.</p>

<p>Now you have a simple but powerful zipper in your hands.
For more fanciness, one could also enjoy the natural functoriality of the list
zipper to add the <code class="highlighter-rouge">map</code> function and allow us to map functions inside it :)</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Map a function to the tracks</span>
<span class="kd">func</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">R</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">f</span><span class="p">:</span> <span class="p">(</span><span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">R</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ListZipper</span><span class="o">&lt;</span><span class="kt">R</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">zipper</span> <span class="o">=</span> <span class="kt">ListZipper</span><span class="o">&lt;</span><span class="kt">R</span><span class="o">&gt;</span><span class="p">()</span>
  <span class="n">zipper</span><span class="o">.</span><span class="n">leftList</span> <span class="o">=</span> <span class="n">leftList</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
  <span class="n">zipper</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
  <span class="n">zipper</span><span class="o">.</span><span class="n">rightList</span> <span class="o">=</span> <span class="n">rightList</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">zipper</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I hope you liked this little taste of functional programming. üòâ</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/what-is-wrong-with-the-object-paradigm/">
            What is wrong with the object paradigm ?
            <small>17 Feb 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/boost-property-tree/">
            How to use boost::property_tree to load and write JSON
            <small>21 Dec 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/an-alternative-error-handling-strategy-cpp/">
            An alternative error handling strategy for C++
            <small>27 Aug 2013</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-10762787-1', 'auto');
    ga('send', 'pageview');
</script>
    

    <footer class="footer">
  <hr/>
  <div class="container">
    <div class="row">
      <p class="text-muted col-sm-10 text-center">
            <span class="sidebar-nav-item small">Make a donation. üòá</span>
            <span class="sidebar-nav-item x-small">BTC: <a href="bitcoin:1JcME7DSCw8b83nEGFKUYTKE4LM8aX4dhJ">1JcME7DSCw8b83nEGFKUYTKE4LM8aX4dhJ</a></span>
            <span class="sidebar-nav-item x-small">ETH: <a href="ethereum:eA22ADf19f20D618D8EF66E4704C540A10708F1F">eA22ADf19f20D618D8EF66E4704C540A10708F1F</a></span>
      </p>
      <p class="col-sm-2">
        <a class="twitter-share-button col-sm"
           href="https://twitter.com/share"
           data-via="Zenol42">
          Tweet
        </a>
      </p>
    </div>
  </div>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/bootstrap/js/vendor/jquery.min.js"><\/script>')</script>
<script src="/public/bootstrap/js/bootstrap.min.js"></script>

<!-- Twitter sharing button loader -->
<script>
  window.twttr = (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
      t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);

    t._e = [];
    t.ready = function(f) {
      t._e.push(f);
    };

    return t;
  }(document, "script", "twitter-wjs"));
</script>

  </body>
</html>
