<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <meta name="description" content="Jeremy Cochoy's personal website.">
  <meta name="author" content="Jeremy Cochoy">

  <title>
    
      Tutoriel d'initiation à SEDNL &middot; Jeremy Cochoy
    
  </title>

  <!-- CSS -->
  <link href="/public/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Custom styles for this template -->
  <link href="/public/style.css" rel="stylesheet">

  <!-- Maths equations -->
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
  });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>


  <body>

    <!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
 <div class="container">
   <div class="navbar-header">
     <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
 <span class="sr-only">Toggle navigation</span>
 <span class="icon-bar"></span>
 <span class="icon-bar"></span>
 <span class="icon-bar"></span>
     </button>
     <a class="navbar-brand" href="/">Jeremy Cochoy</a>
   </div>
   <div id="navbar" class="collapse navbar-collapse">
     <ul class="nav navbar-nav">
     <li><a href="/resume/">Resume</a></li>
 <li><a href="/blog/">Blog</a></li>
 <li role="separator" class="divider"></li>
 <li><a href="/talks/">Talks</a></li>
 <li><a href="/research/">Research</a></li>
 <li><a href="/teaching/">Teaching</a></li>
 <li><a href="/music/">Music</a></li>
 <li class="dropdown">
   <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">More <span class="caret"></span></a>
   <ul class="dropdown-menu">
     <li><a href="/hyper-flop/">Hyper-Flop</a></li>
     <li role="separator" class="divider"></li>
     <li><a href="/pdfs/">PDFs & Talks</a></li>
     <li><a href="/agreg-dev/">Agregation de mathématique</a></li>
     <li role="separator" class="divider"></li>
     <li><a href="https://github.com/jeremycochoy/sednl" alt="SEDNL Github">SEDNL (Github)</a></li>
     <li><a href="http://sednl.zenol.fr" alt="Simple Event Driven Network Library">SEDNL</a></li>
           <li role="separator" class="divider"></li>
           <li><a href="/gb-doc">GameBoy Emulator Documentation</a></li>
   </ul>
 </li>
     </ul>
   </div><!--/.nav-collapse -->
 </div>
</nav>


    <div class="container">
      <div class="post">
  <h1 class="post-title">Tutoriel d'initiation à SEDNL</h1>
  <span class="post-date">25 Aug 2013</span>
  <p>Ce court tutoriel vas vous apprendre à utiliser la bibliothèque réseau SedNL.
Grâce à cette bibliothèque facile et rapide à prendre en main, nous réaliseront
un client et serveur de chat, ainsi qu’une application de dessin collaborative.</p>

<h2 id="installation-de-sednl">Installation de SedNL</h2>

<h3 id="récupération-des-sources">Récupération des sources</h3>

<p>Vous pouvez obtenir les sources de la bibliothèque sur Git Hub.</p>

<p>On supposera l’utilisation de git sous linux, ou bien de msysgit sous windows.</p>

<p>Votre client git en main, et une fois dans le répertoire de travail qui
vous convient, récupérez les sources avec les commandes :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone http://github.com/Zenol/sednl.git
<span class="nb">cd </span>sednl
</code></pre></div></div>

<p>Ensuite, utilisez cmake pour générer les makefile de votre projet.</p>

<p>Commençons par créer un répertoire pour la compilation.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>build
<span class="nb">cd </span>build
</code></pre></div></div>

<p>Pour le moment, VC++ ne supporte pas encore le C++11, et il n’est
malheureusement pas possible de compiler SedNL avec le compilateur de
Microsoft. La procédure pour utiliser MinGW est légèrement plus compliquée.</p>

<p>Sous linux :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmake ..
</code></pre></div></div>

<p>Sous Windows pour utiliser MinGW :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmake <span class="nt">-G</span> <span class="s2">"MinGW Makefiles"</span> ..
</code></pre></div></div>

<p>Vous pouvez éventuellement personnaliser le build en exécutant <code class="language-plaintext highlighter-rouge">cmake-gui</code> sous
linux ou <code class="language-plaintext highlighter-rouge">cmake-gui.exe</code> sous Windows.</p>

<p>Vous pouvez maintenant lancer la compilation avec <code class="language-plaintext highlighter-rouge">make</code> sous linux,
et <code class="language-plaintext highlighter-rouge">mingw32-make</code> sous Windows avec mingw.</p>

<p>Une fois la compilation terminé, vous obtenez une bibliothèque statique
<code class="language-plaintext highlighter-rouge">sednl-1.0.a</code> et une dynamique <code class="language-plaintext highlighter-rouge">sednl-1.0.so</code>. (.lib et .dll sous windows).</p>

<p>C’est terminé, nous allons pouvoir compiler notre premier programme.</p>

<h2 id="service-de-log-dextraits-de-code">Service de log d’extraits de code</h2>

<p>Pour nos premiers pas avec cette bibliothèque, nous allons réaliser une
application cliente capable d’envoyer un extrait de code lue depuis l’entrée
standard vers un serveur qui loggera tout les extraits reçus, sur sa sortie
standard.</p>

<h3 id="le-client">Le client</h3>

<p>Commençons par le client. Il doit recevoir un extrait de code sur son entrée
standard, puis l’envoyer au serveur.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;SEDNL/sednl.hpp&gt;
#include &lt;iostream&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">SedNL</span><span class="p">;</span>

<span class="c1">// Read input from stdin</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">get_input</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">line</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">line</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" listing_name"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="c1">//Connect to server port 4280</span>
        <span class="n">TCPClient</span> <span class="n">client</span><span class="p">(</span><span class="n">SocketAddress</span><span class="p">(</span><span class="mi">4280</span><span class="p">,</span> <span class="s">"localhost"</span><span class="p">));</span>

        <span class="c1">//Read the input</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">input</span> <span class="o">=</span> <span class="n">get_input</span><span class="p">();</span>

        <span class="c1">//Send the code to log</span>
        <span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">make_event</span><span class="p">(</span><span class="s">"log_that"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">input</span><span class="p">));</span>

        <span class="n">client</span><span class="p">.</span><span class="n">disconnect</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(...)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Failed to connect"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Si le fichier se nome « client.cpp », vous pouvez le compiler avec la ligne
<code class="language-plaintext highlighter-rouge">clang++ -std=c++11 -I/usr/local/include/sednl-1.0/ -lsednl-1.0 -lpthread client.cpp</code>.</p>

<p>La première fonction <code class="language-plaintext highlighter-rouge">get_input</code> lit l’entrée standard et stocke tout l’extrait de code dans une chaîne qu’elle renvoie.</p>

<p>Par la suite, on demande à ce que le premier argument du programme soit le nom
de l’extrait de code (<code class="language-plaintext highlighter-rouge">argv[0]</code>).</p>

<p>Enfin, c’est à la ligne 26 que commence vraiment notre programme.
On commence par ouvrir une connexion vers <code class="language-plaintext highlighter-rouge">localhost</code>. C’est l’ordinateur
qui exécute ce programme. On peux aussi indiquer « 127.0.0.1 ».
Le port sur le quel on cherche à atteindre le serveur est le port « 4280 ».
Un port n’a pas de réalitée matériel, c’est juste une façon de distinguer
les différentes connexions ouverte vers un ordinateur.
Le choix du numéro de port est arbitraire, même si l’on cherchera à
éviter d’utiliser les plus communs (comme 80 pour http,
20 et 21 pour ftp, etc.) ainsi que les valeurs inférieurs à 1024, car
certains système requière des privilèges administrateur pour les utiliser.</p>

<p>La ligne 35 fait deux choses. D’abord, <code class="language-plaintext highlighter-rouge">make_event</code> fabriquer un objet
de type <code class="language-plaintext highlighter-rouge">Event</code> qui contient :</p>

<p>1)  Le nom de l’évènement envoyé au serveur. Ici, <code class="language-plaintext highlighter-rouge">"log_that"</code>.
2)  Le nom sous le quel l’extrait de code sera enregistré. Ici, <code class="language-plaintext highlighter-rouge">argv[1]</code>.
3)  L’extrait de code à logger. Ici, <code class="language-plaintext highlighter-rouge">input</code>.</p>

<p>Une fois l’évènement crée, il est envoyé avec par la fonction membre <code class="language-plaintext highlighter-rouge">send</code>.</p>

<p>Enfin, la connexion est fermée à la ligne 37.</p>

<p>Si le serveur est indisponible, la connexion échoue, et une exception est
levée. Elle est alors attrapée à la ligne 39.</p>

<h3 id="le-serveur">Le serveur</h3>

<p>Le serveur n’est pas beaucoup plus compliqué. Il doit attendre de nouvelle
connections, et écrire sur la sortie standard le texte reçu. Attention,
il faudra bien penser à gérer le cas où deux clients envoie un message
au même moment. Pour ça, on utilisera une mutex.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;SEDNL/sednl.hpp&gt;
#include &lt;iostream&gt;
#include &lt;mutex&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">SedNL</span><span class="p">;</span>

<span class="c1">//Locked when writing to stdout</span>
<span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">log_mutex</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">on_log_that</span><span class="p">(</span><span class="n">Connection</span><span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">log_name</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">log_content</span><span class="p">;</span>

    <span class="n">PacketReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">get_packet</span><span class="p">();</span>
    <span class="n">reader</span> <span class="o">&gt;&gt;</span> <span class="n">log_name</span> <span class="o">&gt;&gt;</span> <span class="n">log_content</span><span class="p">;</span>

    <span class="n">log_mutex</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"--------------------"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span> <span class="o">&lt;&lt;</span> <span class="n">log_name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"--------------------"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">log_content</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">log_mutex</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">TCPServer</span> <span class="n">server</span><span class="p">(</span><span class="n">SocketAddress</span><span class="p">(</span><span class="mi">4280</span><span class="p">));</span>

        <span class="n">EventListener</span> <span class="n">listener</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

        <span class="n">EventConsumer</span> <span class="n">consumer</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
        <span class="n">consumer</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="s">"log_that"</span><span class="p">).</span><span class="n">set_function</span><span class="p">(</span><span class="n">on_log_that</span><span class="p">);</span>

        <span class="n">listener</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
        <span class="n">consumer</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>

        <span class="c1">// Sleep</span>
        <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span>
            <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">1000</span><span class="p">));</span>
        <span class="n">listener</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span><span class="p">(...)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Failed to connect"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">EXIT_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/list-zipper-swift/">
            List Zipper applied to iOS swift
            <small>24 May 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/what-is-wrong-with-the-object-paradigm/">
            What is wrong with the object paradigm ?
            <small>17 Feb 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/boost-property-tree/">
            How to use boost::property_tree to load and write JSON
            <small>21 Dec 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-10762787-1', 'auto');
    ga('send', 'pageview');
</script>
    

    <footer class="footer">
  <hr/>
  <div class="container">
    <div class="row">
      <p class="text-muted col-sm-10 text-center">
            <span class="sidebar-nav-item small">Make a donation. 😇</span>
            <span class="sidebar-nav-item x-small">BTC: <a href="bitcoin:1JcME7DSCw8b83nEGFKUYTKE4LM8aX4dhJ">1JcME7DSCw8b83nEGFKUYTKE4LM8aX4dhJ</a></span>
            <span class="sidebar-nav-item x-small">ETH: <a href="ethereum:eA22ADf19f20D618D8EF66E4704C540A10708F1F">eA22ADf19f20D618D8EF66E4704C540A10708F1F</a></span>
      </p>
      <p class="col-sm-2">
        <a class="twitter-share-button col-sm"
           href="https://twitter.com/share"
           data-via="Zenol42">
          Tweet
        </a>
      </p>
    </div>
  </div>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/bootstrap/js/vendor/jquery.min.js"><\/script>')</script>
<script src="/public/bootstrap/js/bootstrap.min.js"></script>

<!-- Twitter sharing button loader -->
<script>
  window.twttr = (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
      t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);

    t._e = [];
    t.ready = function(f) {
      t._e.push(f);
    };

    return t;
  }(document, "script", "twitter-wjs"));
</script>

  </body>
</html>
