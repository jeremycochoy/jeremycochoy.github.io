<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <meta name="description" content="Jeremy Cochoy's personal website.">
  <meta name="author" content="Jeremy Cochoy">

  <title>
    
      An alternative error handling strategy for C++ &middot; Jeremy Cochoy
    
  </title>

  <!-- CSS -->
  <link href="/public/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Custom styles for this template -->
  <link href="/public/style.css" rel="stylesheet">

  <!-- Maths equations -->
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
  });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>


  <body>

    <!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
 <div class="container">
   <div class="navbar-header">
     <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
 <span class="sr-only">Toggle navigation</span>
 <span class="icon-bar"></span>
 <span class="icon-bar"></span>
 <span class="icon-bar"></span>
     </button>
     <a class="navbar-brand" href="/">Jeremy Cochoy</a>
   </div>
   <div id="navbar" class="collapse navbar-collapse">
     <ul class="nav navbar-nav">
 <li><a href="/blog/">Blog</a></li>
 <li><a href="/resume/">Resume</a></li>
 <li role="separator" class="divider"></li>
 <li><a href="/research/">Research</a></li>
 <li><a href="/talks/">Talks</a></li>
 <li><a href="/teaching/">Teaching</a></li>
 <li><a href="/music/">Music</a></li>
 <li class="dropdown">
   <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">More <span class="caret"></span></a>
   <ul class="dropdown-menu">
     <li><a href="/hyper-flop/">Hyper-Flop</a></li>
     <li role="separator" class="divider"></li>
     <li><a href="/pdfs/">PDFs & Talks</a></li>
     <li><a href="/agreg-dev/">Agregation de mathématique</a></li>
     <li role="separator" class="divider"></li>
     <li><a href="https://github.com/jeremycochoy/sednl" alt="SEDNL Github">SEDNL (Github)</a></li>
     <li><a href="http://sednl.zenol.fr" alt="Simple Event Driven Network Library">SEDNL</a></li>
           <li role="separator" class="divider"></li>
           <li><a href="/gb-doc">GameBoy Emulator Documentation</a></li>
   </ul>
 </li>
     </ul>
   </div><!--/.nav-collapse -->
 </div>
</nav>


    <div class="container">
      <div class="post">
  <h1 class="post-title">An alternative error handling strategy for C++</h1>
  <span class="post-date">27 Aug 2013</span>
  <h2 id="error-handling">Error handling</h2>

<p>This not so short post is dedicated to a subject that may interest many
programers: error handling.</p>

<p>Error handling is the “dark side” of programming. It is both the heart of
real world applications, and the dirty stuff you would like to avoid.</p>

<p>Since the C years, I know three most common ways of handling errors.</p>

<h2 id="do-it-c-style-return-code">Do it C-style: return code</h2>

<p>‘C-Style’ handling is the easiest way to do it, but it isn’t completely satisfying.</p>

<p>C-Style error handling is basicaly “returning an error code when the application
failed”. Here is short example.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">find_slash</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'/'</span><span class="p">)</span>
          <span class="n">i</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//Error code</span>

    <span class="c1">//True value</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// . . .</span>

<span class="k">if</span> <span class="p">(</span><span class="n">find_slash</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
        <span class="c1">//error handling</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="whats-good-here">What’s good here?</h3>

<p>You can (and actualy, in C style, you do), right after the call, directly handle
the error by eventualy displaying a message and terminating the application,
or just retrieving the last state, aborting the computation…</p>

<p>When you wan’t to find where the error handling is made, you just have to look at
the <strong>function call</strong>. It’s <strong>right</strong> after.</p>

<h3 id="whats-bad-here">What’s bad here?</h3>

<p>As some may have told you, it mix error handling with proper “execution flow”.
When you read linearly the code as the code execute, you read sometime error
handling, and some time program logic. That’s really bad, because you would like to
read either “program logic” or “error handling”.</p>

<p>Also notice that you are limited to an “error code”. If you want to provide
more informations, you’ll have to create some functions (like errstr) and / or
use global variables;</p>

<h2 id="do-it-c-style-exceptions">Do it C++-style: exceptions</h2>

<p>When C was “enhanced” to c++, a new way of handling errors was introduced. It
was “exceptions”. Exceptions are a way of breaking the normal flow of your code
by “throwing” an error that will be “catched” somewhere else. Again, a short example.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">find_slash</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'/'</span><span class="p">)</span>
          <span class="n">i</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span>
        <span class="k">throw</span> <span class="n">AnException</span><span class="p">(</span><span class="s">"Error message"</span><span class="p">);</span>

    <span class="c1">//True value</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// . . .</span>

<span class="k">try</span>
<span class="p">{</span>
    <span class="n">find_slash</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="n">AnException</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
   <span class="c1">//Handle exception</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="whats-good-here-1">What’s good here?</h3>

<p>Program logic and error handling are separated. On one side you can see how the function
whork and when it fail, on the other part you can see what it does if it failed.
It’s pretty, simplify reading of both error handling and program logic.</p>

<p>The second point is that now you can give as many information as you like, since
you can put what you want in your MyException object.</p>

<h2 id="whats-bad-here-1">What’s bad here?</h2>

<p>Writing exceptions well is verbose. You need an exception tree, if possible not too big, so that you can catch only the exception you are interesting it. Also, you need some
error codes inside, to know exactly what hapenned, retrieve an error message, etc.
Writing exceptions class <strong>is</strong> verbose, it’s the cost of the flexibility given by the
ability to handle more informations embeded as an error.</p>

<p>The way encouraged by this philosophy is to postpone error handling as late as possible,
so that users can have the highest flexibility to handle errors. Thats theoricaly a good
thing, but…</p>

<p>In big applications, you <strong>can’t</strong> find esily where the error is handled. When you wan’t
to know what would be the path of an error, you have to jump across files, functions,
and it’s really hard to find, if you introduce a new exception deep in the “call ~graph~ tree” (I mean the graph you would have if you draw each function call) then you have to
figure out where it should be handled, if it is already handled, in which places. It’s
really hard when the application is big, old, not really well writen everywhere. Actualy
it’s the case of most of the commercial projects. And that is that.</p>

<p>That’s what make me state “Exceptions are dangerous”. Of course, they provide a pretty
well to handle error… but only when you are working on small project, where the
“call graph” is simple and easy to get in the mind.</p>

<h2 id="the-error-box-pattern">The error box pattern</h2>

<p>I call it a pattern, so that people don’t be afraid. At the end, I’ll call it with it’s
right name, so please, be patient.</p>

<p>The main idea is creating a box that can contain either an error message or a value. We
will limit ourself to a string, and nothing more, because it’s actualy not so easy to
implement. We will try to keep the syntax readable, understandable, for use cases.
We won’t handle correctly copy constructor, more than one parameter functions,
and rvalues. We will keep it as simple as possible.</p>

<p>Let’s start with an example of use:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">E</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">find_slash</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'/'</span><span class="p">)</span>
          <span class="n">i</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fail</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"Error message"</span><span class="p">);</span>

    <span class="c1">//True value</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// . . .</span>

<span class="k">auto</span> <span class="n">v</span> <span class="o">=</span> <span class="n">find_slash</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//Handle exception</span>
<span class="p">}</span>
</code></pre></div></div>

<p>At the first look, it may look like it is the same thing as the C-style. But it isn’t.
To see that, you have to look at more than one function call.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">E</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">find_slash</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">);</span>
<span class="n">E</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">do_some_arithmetic</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="n">E</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">format</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="n">E</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">display</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">v</span> <span class="o">=</span> <span class="n">ret</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
         <span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">find_slash</span><span class="p">)</span>
         <span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">do_some_arithmetic</span><span class="p">)</span>
         <span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
         <span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">display</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//Handle error</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ok, so what happened ? Bind is a member function that takes your function, and tries
to apply it. If there is a value in the “error box”, then it aplies to function, and then
returns an error box (the compiler won’t let you give a function that doesn’t return
an error box).</p>

<p>So, we chained the call to find_slash, do_some_arithmetic, format and display. None
of them can take an error box, but thanks to bind, we “transformed” the functions <code class="highlighter-rouge">E&lt;something_out&gt; f(something_in)</code> to
functions of type <code class="highlighter-rouge">E&lt;something_out&gt; f(E&lt;something_in&gt;)</code>.</p>

<h3 id="whats-good-here-2">What’s good here?</h3>

<p>Once again, program logic (the chain) and error handling (the if) are separated. Like
with exception, we have the ability to read the chain and don’t think about where
the execution is interrupted. Actualy, the chain <strong>may</strong> be interrupted at <strong>any</strong> step.
But we can think as if no error is happening and check quickly if our logic is right.</p>

<p>Of course, typing will prevent you from binding format after a display, so we
don’t lose any typing capabilities.</p>

<p>Notice that we aren’t calling any of those function in any other. We are “composing”
them at the end. That is the key to make it works. You should, write small modular
functions (hey, look at that: you <strong>should</strong> write generic code so that it can work)
that accept a value, then compute an other “new” value, or fail. And at each
step, you don’t have to think about where an exception may interrupt your control
flow and take care of maintain you stuff in a valid state (exception safety is basically
beeing always looking at each call you do, and figure out if the function can interrupt
your flow and what will happen if it does). For this point, it’s “safer”.</p>

<p>As with exceptions, we can have “as many information as you like”, although in this
post we will write it “half template”, so that it’s a bit easier to understand.</p>

<p>We can easily locate <strong>where</strong> error handling happens. It’s always after a chaining
(unless the value is chained again). We have now a big execution flow, without
interruption, and small error handling flow, easy to locate. When a new error is added,
you just have to find the calls, following the chains, and you’ll get back directly to
the handling, and add what’s needed.
Big projects are more “linear” and easy to read.</p>

<h3 id="whats-bad-here-2">What’s bad here?</h3>

<p>First, it’s new. It’s not integrated to C++, it’s not the standard way, and with the
stl you’ll still have to use exceptions.</p>

<p>It’s still a bit too much verbose for my taste. The need to write explicitely the type in
<code class="highlighter-rouge">fail&lt;int&gt;("...")</code> is bad. If you had a polymorphic error type, then it’s worst because
you’ll have to write <code class="highlighter-rouge">fail&lt;return_type, error_type&gt;("...")</code>.</p>

<p>It do not provide an easy way to call a function that need more than one argument.
In some other languages, you have “applicative” types and currification that solve it
nicely, but that’s far from what you may expect from c++. I’m more likely to think that
a <code class="highlighter-rouge">bind2(E&lt;a&gt;, E&lt;b&gt;, f)</code> and <code class="highlighter-rouge">bind3(E&lt;a&gt;, E&lt;b&gt;, E&lt;c&gt;, f)</code> function could be used.
Variadic templates may help.</p>

<p>To get the value “out of the box”, we have to check if the box is really a value,
and then call a “to_value” method. And we have no means from doing it without
checking. What we would like to have is “deconstruction” of objects, but this doesn’t
exist in c++, and it’s not the kind of things you just have to say “hey, let’s
add it to the next standard”.</p>

<p>At the moment, I don’t know how you could adapt it to member functions. If you have
an idea, try it, and if it works, tell us :)</p>

<h2 id="implementing-a-monadic-error-handling">Implementing a monadic error handling</h2>

<p>I unleashed the demons, I wrote the name from dark magic. It’s <a href="/haskell-pure-3/">monad</a>. You can think of
monad as “box” containing a value in a “context”. For example, a box that contains
either a value or nothing is a monad (I let you write the implementation as an exercise).
This concept was heavily used and abused by the language <a href="https://en.wikipedia.org/wiki/Haskell_(programming_language)">Haskell</a>,
so if you are curious you can have a look at my <a href="/haskell-pure-1/">french introduction crash course</a>.</p>

<p>A bit stranger, lists are monad. They are “a value” in a context, from a certain
point of view.</p>

<p>Let’s start by implementing the E class you saw above. I’m relying on C++11 <code class="highlighter-rouge">decltype</code>
and <code class="highlighter-rouge">auto -&gt; decltype</code> wich allow figuring out the type of things from expressions. It’s
really useful.</p>

<p>The bind function is a bit strange, but it does what I stated previously.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cm">/*
This is the "Either String" monad, as a way to handle errors.
*/</span>

<span class="k">template</span>
<span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">E</span>
<span class="p">{</span>
<span class="nl">private:</span>
    <span class="c1">//The value stored</span>
    <span class="n">T</span> <span class="n">m_value</span><span class="p">;</span>
    <span class="c1">//The error message stored</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_error</span><span class="p">;</span>
    <span class="c1">//A state. True it's a value, false it's the message.</span>
    <span class="kt">bool</span> <span class="n">m_valid</span><span class="p">;</span>

    <span class="n">E</span><span class="p">()</span>
    <span class="p">{}</span>

<span class="nl">public:</span>
    <span class="c1">//Encapsulate the value</span>
    <span class="k">static</span> <span class="n">E</span> <span class="n">ret</span><span class="p">(</span><span class="n">T</span> <span class="n">v</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">E</span> <span class="n">box</span><span class="p">;</span>
        <span class="n">box</span><span class="p">.</span><span class="n">m_value</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">box</span><span class="p">.</span><span class="n">m_valid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">box</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Encapsulate an error</span>
    <span class="k">static</span> <span class="n">E</span> <span class="n">fail</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">E</span> <span class="n">box</span><span class="p">;</span>
        <span class="n">box</span><span class="p">.</span><span class="n">m_error</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
        <span class="n">box</span><span class="p">.</span><span class="n">m_valid</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">box</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//True if it's a valid value</span>
    <span class="k">operator</span> <span class="kt">bool</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">m_valid</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Deconstruct an E to a value</span>
    <span class="n">T</span> <span class="n">to_value</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="c1">//It's a programmer error, it shouldn't happen.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!*</span><span class="k">this</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"You can't deconstruct to a value from an error"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Deconstruct an E to an error</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">to_error</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="c1">//It's a programmer error, it shouldn't happen.</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"You can't deconstruct to an error from a value"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_error</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">oss</span><span class="p">,</span> <span class="k">const</span> <span class="n">E</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">box</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="n">oss</span> <span class="o">&lt;&lt;</span> <span class="n">box</span><span class="p">.</span><span class="n">m_value</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">oss</span> <span class="o">&lt;&lt;</span> <span class="n">box</span><span class="p">.</span><span class="n">m_error</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">oss</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span>
    <span class="kr">inline</span>
    <span class="k">auto</span> <span class="n">bind</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">m_value</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="n">type</span> <span class="o">=</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">m_value</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">m_value</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">type</span><span class="o">::</span><span class="n">fail</span><span class="p">(</span><span class="n">m_error</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

</code></pre></div></div>

<p>I also overloaded the <code class="highlighter-rouge">&lt;&lt;</code> operator, so that it’s easier to see what the box contains.
We don’t really need it, and it may be a good idea to remove it for a “true” usage.</p>

<p>If you look at this, and the example, we need a “E<void>" type, but it won't work as if.
We need a special instance for void. It's exactly the same thing, except that a
value is now an "empty box".</void></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
    Special instance for void
*/</span>

<span class="k">template</span><span class="o">&lt;&gt;</span>
<span class="k">class</span> <span class="nc">E</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_error</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">m_valid</span><span class="p">;</span>

    <span class="n">E</span><span class="p">()</span>
    <span class="p">{}</span>

<span class="nl">public:</span>
    <span class="c1">//Encapsulate the value</span>
    <span class="k">static</span> <span class="n">E</span> <span class="n">ret</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">E</span> <span class="n">box</span><span class="p">;</span>
        <span class="n">box</span><span class="p">.</span><span class="n">m_valid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">box</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Encapsulate an error</span>
    <span class="k">static</span> <span class="n">E</span> <span class="n">fail</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">E</span> <span class="n">box</span><span class="p">;</span>
        <span class="n">box</span><span class="p">.</span><span class="n">m_error</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
        <span class="n">box</span><span class="p">.</span><span class="n">m_valid</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">box</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//True if it's a valid value</span>
    <span class="k">operator</span> <span class="kt">bool</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">m_valid</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Déconstruct an E to a value</span>
    <span class="kt">void</span> <span class="n">to_value</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="c1">//It's a programmer error, it shouldn't happen.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!*</span><span class="k">this</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"You can't deconstruct to a value from an error"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Deconstruct an E to an error</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">to_error</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="c1">//It's a programmer error, it shouldn't happen.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"You can't deconstruct to an error from a value"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">terminate</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">m_error</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">oss</span><span class="p">,</span> <span class="k">const</span> <span class="n">E</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;&amp;</span> <span class="n">box</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="n">oss</span> <span class="o">&lt;&lt;</span> <span class="s">"()"</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">oss</span> <span class="o">&lt;&lt;</span> <span class="n">box</span><span class="p">.</span><span class="n">m_error</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">oss</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span>
    <span class="kr">inline</span>
    <span class="k">auto</span> <span class="n">bind</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="n">type</span> <span class="o">=</span> <span class="k">decltype</span><span class="p">(</span><span class="n">f</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">();</span>
        <span class="k">else</span>
        <span class="k">return</span> <span class="n">type</span><span class="o">::</span><span class="n">fail</span><span class="p">(</span><span class="n">m_error</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Oh, we don’t spoke about <code class="highlighter-rouge">ret</code> and <code class="highlighter-rouge">fail</code>. Actually, they are just wraper around
the <code class="highlighter-rouge">xxx::fail</code> and <code class="highlighter-rouge">xxx::ret</code> functions.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
   Then, I introduced those simple functions, to reduce the
   call to something readable/writable
 */</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kr">inline</span>
<span class="n">E</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">ret</span><span class="p">(</span><span class="n">T</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">E</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">ret</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kr">inline</span>
<span class="n">E</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">fail</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">err</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">E</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">fail</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There, we are, you can compile and play with the example above.</p>

<p>If you want more stuff to play with, I also have this “more realistic” example:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
    Here comes a use case.
*/</span>

<span class="c1">// What a user would see:</span>

<span class="c1">//Return a value in an error context</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kr">inline</span>
<span class="n">E</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">ret</span><span class="p">(</span><span class="n">T</span> <span class="n">v</span><span class="p">);</span>
<span class="c1">//Fail in an error context of type T</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kr">inline</span>
<span class="n">E</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">fail</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">err</span><span class="p">);</span>

<span class="c1">// What a user would write:</span>

<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">vs</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>

<span class="c1">//Parse a +- formated string.</span>
<span class="c1">//If a letter is prefixed by +, then the function toupper is applied.</span>
<span class="c1">//''                                              tolower is applied.</span>
<span class="c1">//Non alphabetical (+ and - excepted) aren't alowed.</span>
<span class="c1">//Words are cut on each space ' '. Other blank characters aren't alowed.</span>
<span class="n">E</span><span class="o">&lt;</span><span class="n">vs</span><span class="o">&gt;</span> <span class="n">parse</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">vs</span> <span class="n">vec</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">fail</span><span class="o">&lt;</span><span class="n">vs</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"Empty string aren't allowed"</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">stack</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="p">{</span>
        <span class="k">case</span> <span class="sc">'-'</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">'+'</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">' '</span><span class="p">:</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">stack</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
                <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">stack</span><span class="p">);</span>
            <span class="n">stack</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nl">default:</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isalpha</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">return</span> <span class="n">fail</span><span class="o">&lt;</span><span class="n">vs</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"Only alpha characters are allowed"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tolower</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">toupper</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
            <span class="k">else</span>
                <span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">stack</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">vec</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Take the first word and append it to the begining of all other words.</span>
<span class="c1">//Vec should contain at least one element.</span>
<span class="n">E</span><span class="o">&lt;</span><span class="n">vs</span><span class="o">&gt;</span> <span class="n">prefixy</span><span class="p">(</span><span class="n">vs</span> <span class="n">vec</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">fail</span><span class="o">&lt;</span><span class="n">vs</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"Can't add prefixes on an empty table"</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">vec</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
    <span class="n">vs</span> <span class="n">out</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">s</span> <span class="o">:</span> <span class="n">vec</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prefix</span> <span class="o">==</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="n">out</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">"^"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Concatenate all strings as a big string. Vec should contain data.</span>
<span class="n">E</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">concat</span><span class="p">(</span><span class="n">vs</span> <span class="n">vec</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">fail</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"Empty vectors aren't allowed"</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">s</span> <span class="o">:</span> <span class="n">vec</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">s</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">fail</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"No data found"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>

    <span class="c1">//Parse some string, show how error interrupt computation of the "chain".</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span><span class="p">((</span><span class="n">s</span><span class="p">)</span><span class="s">"+hello    -WORLD"</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">parse</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">prefixy</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span><span class="p">((</span><span class="n">s</span><span class="p">)</span><span class="s">"+hello Hello  Hello"</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">parse</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">prefixy</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span><span class="p">((</span><span class="n">s</span><span class="p">)</span><span class="s">"+   "</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">parse</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">prefixy</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span><span class="p">((</span><span class="n">s</span><span class="p">)</span><span class="s">"+hi"</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">parse</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">prefixy</span><span class="p">).</span><span class="n">bind</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">//Play with lambda to "replace" a value if it's not an error.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span><span class="p">((</span><span class="n">s</span><span class="p">)</span><span class="s">"Some string"</span><span class="p">).</span><span class="n">bind</span><span class="p">([](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="n">fail</span><span class="o">&lt;</span><span class="n">s</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"Failed"</span><span class="p">);});</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span><span class="p">(</span><span class="mi">23</span><span class="p">).</span><span class="n">bind</span><span class="p">([](</span><span class="k">const</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="mi">42</span><span class="p">);});</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">fail</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"NaN"</span><span class="p">).</span><span class="n">bind</span><span class="p">([](</span><span class="k">const</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="n">ret</span><span class="p">(</span><span class="mi">42</span><span class="p">);});</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/what-is-wrong-with-the-object-paradigm/">
            What is wrong with the object paradigm ?
            <small>17 Feb 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/boost-property-tree/">
            How to use boost::property_tree to load and write JSON
            <small>21 Dec 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/tutorial-sednl/">
            Tutoriel d'initiation à SEDNL
            <small>25 Aug 2013</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-10762787-1', 'auto');
    ga('send', 'pageview');
</script>
    

    <footer class="footer">
  <hr/>
  <div class="container">
    <div class="row">
      <p class="text-muted col-sm-10 text-center">
            <span class="sidebar-nav-item small">Make a donation. 😇</span>
            <span class="sidebar-nav-item x-small">BTC: <a href="bitcoin:1JcME7DSCw8b83nEGFKUYTKE4LM8aX4dhJ">1JcME7DSCw8b83nEGFKUYTKE4LM8aX4dhJ</a></span>
            <span class="sidebar-nav-item x-small">ETH: <a href="ethereum:eA22ADf19f20D618D8EF66E4704C540A10708F1F">eA22ADf19f20D618D8EF66E4704C540A10708F1F</a></span>
      </p>
      <p class="col-sm-2">
        <a class="twitter-share-button col-sm"
           href="https://twitter.com/share"
           data-via="Zenol42">
          Tweet
        </a>
      </p>
    </div>
  </div>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/bootstrap/js/vendor/jquery.min.js"><\/script>')</script>
<script src="/public/bootstrap/js/bootstrap.min.js"></script>

<!-- Twitter sharing button loader -->
<script>
  window.twttr = (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
      t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);

    t._e = [];
    t.ready = function(f) {
      t._e.push(f);
    };

    return t;
  }(document, "script", "twitter-wjs"));
</script>

  </body>
</html>
